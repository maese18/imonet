# API

## Common response format

A successful response MUST contain a meta and an item or an items object. The meta property can contain additional data such as request headers or other info.

Example response for items:
```
{
  "meta": {
    "headers": {
      "accept": "*/*",
      "cache-control": "no-cache",
    }
  },
  "items": [
    {
      "id": 1,
      "title": "First Object",
      "mediaFiles": []
    },
    {...}
  ]
}
```

Example response for a single item:
```
{
  "meta": {
    "headers": {
      "accept": "*/*",
      "cache-control": "no-cache",
    }
  },
  "item": 
    {
      "id": 1,
      "title": "First Object",
      "mediaFiles": []
    }
}
```

Erroneous responses MUST replace the item/items attribute with an errors array.

If using axios the response object is packed within the ***data*** property.

## RealEstates
------

### GET /api/realEstates

#### Function: 
Returns all realEstates objects for the tenant identified by the JwtToken
#### Headers: 

- Authorization: "Bearer {validJWTToken}"

------
### POST /api/realEstates
#### Function: 
Saves a RealEstate object
#### Headers: 
- Authorization: "Bearer {validJWTToken}"
- Content-Type: "application/json"
- Accept: "application/json"

#### Body
RealEstate object

------
### GET /api/mediaFiles/:mediaFileId

#### Function: 
Downloads the file with the id {mediaFileId}.
Depending on the group the requesting user belongs to and the required group 
on the mediaFiles ***minReadGroup*** field, the file access can be restricted.
- minReadGroup=1 => the file is public
- minReadGroup=2 => the file can be seen by an individual (that is a user not belonging to a tenant). 
  However this individual needs to be authenticated.
  NOT IMPLEMENTED YET: Restriction to a set of individuals

#### Parameters:
- optional query parameter realEstateId
#### Headers: 

- Authorization: "Bearer {validJWTToken}"

#### Authorization:
- This route is restricted to the groups tenantUser and tenantSuperUser
------
### GET /api/mediaFiles

#### Function: 
Returns all mediaFiles of the tenant identified by the JwtToken.
An additional filter can be set by a query parameter realEstateId which restricts the mediaFiles to the
mediaFiles to those attached to the realEstate object identified by the realEstateId.

#### Parameters:
- optional query parameter realEstateId
#### Headers: 

- Authorization: "Bearer {validJWTToken}"

#### Authorization:
- This route is restricted to the groups tenantUser and tenantSuperUser

------  
### POST /api/mediaFiles
#### Function:
Creates a mediaFile object AND uploads an associated file.

#### Headers:
- Authorization: "Bearer {validJWTToken}"
#### Body:
in ***form-data***:
the following key-values need to be filled:
- realEstateId: the id of the realEstate object to associate the mediaFile with. This object must exists
- mediaFile of type **file**: the file to upload
- clientSideId: An id generated by the client (possibly not necessary)
- description: description of the file
- purpose: purpose of the file, see MediaFile
- title: title of the file

To upload **multiple files**, the multi-part form must be changed by adding _{index} token
all parameters except realEstateId
#### Authorization:
- Authorized for users in group 'tenantUser' and above (that is currently 'tenantSuperUser')
- Upload for the tenant the user belongs to is allowed optionallyAuthorized
--------

--------
# Authorization
## Permissions
- 1: Read
- 2: Modify
- 3: Delete

## Groups
- 1: Anonymous User
- 2: Individual User
- 3: Individual User with granted permission
- 4: Tenant User 
- 5: Tenant SuperUser


Example for mediaFile:

- A mediaFile is public ==> minimal required Group is **1: Anonymous User**
- A mediaFile is restricted to individual users 
  ==> minimal required Group is **2: Individual User**. If the user is part of this group an explicit permission is required. Groups 3 and 4 are permitted.
- A mediaFile is restricted to **3: Tenant User** ==> The user must be in group 3 or 4 

Each mediaFile got a minimal required group for each of the permissions:
- minGroupRead
- minGroupModify
- minGroupDelete