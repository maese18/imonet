worker_processes  5;
error_log  logs/error.log;


pid        logs/nginx.pid;
worker_rlimit_nofile 8192;

events {
  worker_connections  4096;  ## Default: 1024
}

#include /etc/letsencrypt/options-ssl-nginx.conf;
#ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

http {
    tcp_nopush   on;
    server_names_hash_bucket_size 128; # this seems to be required for some vhosts
    access_log logs/access.log;
    resolver 127.0.0.11 ipv6=off;
    resolver_timeout 5s;

    # Means that proxy_pass hosts, here imonetprod_web is resolved to addresses listed as server, that is imonetprod_web_1:80
    # weight=3 means that this server is preferred
    upstream imonetprod_web {
        server imonetprod_web_1:80 weight=3;
        #server imonetprod_web_2:80;
        #server imonetprod_web_3:80;    
    }
    #server {
    #    listen 80;
    #    server_name adivo.ch;
    
     #   location / {
      #      return 301 https://$host$request_uri;
            
            #proxy_pass         http://imonetprod_web_1:80;
       # }    
    #}
    # server {
    #    listen 80 default_server;
    #    listen [::]:80 default_server;
    #    server_name _;
     #   return 301 https://$host$request_uri;
    #}  

     server {
        listen 443 ssl;
        server_name adivo.ch;
        
        location / {
            #proxy_pass http://imonetprod_web_1:80; #for demo purposes
            proxy_pass http://imonetprod_web; #for demo purposes
        }
       
        ssl_certificate /etc/letsencrypt/live/adivo.ch/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/adivo.ch/privkey.pem;
    }

    #server {
     #   listen 443 ssl http2;
      #  server_name www.adivo.ch;

        # . . . other code

       # return 301 https://adivo.ch$request_uri;
 #   }
}
